{% extends "base.html" %}

{% block content %}
<noscript><b>It seems JavaScript is either disabled or not supported by your browser.</b>
    JavaScript should be enabled in order to support all functionalities.
    Enable JavaScript by changing your browser options, and then try again.
</noscript>

<script type="text/javascript" src="http://www.google.com/jsapi"></script>
  <script type="text/javascript">
    google.load('visualization', '1', {packages: ['geochart']});
    google.setOnLoadCallback(drawVisualization);
    var data; 
    var setOn = 0;
    function drawVisualization() {
      data = google.visualization.arrayToDataTable([
      ['Country', 'Count'],
      {% for geoinfo in geovisits %}
        {% if geoinfo.0|length > 0 %}
            ['{{ geoinfo.0 }}', {{ geoinfo.1 }}],
        {% endif %}
      {% endfor %}
      ]);
    
      var geochart = new google.visualization.GeoChart(
          document.getElementById('googlemap'));
      google.visualization.events.addListener(geochart, 'select',
            function () {
               var selection = geochart.getSelection()[0];
               var countrycode = data.getValue(selection.row, 0);
               window.location.replace("{% url metashare.views.frontpage %}stats/top/?view={{ view }}&country="+countrycode);
      });
      
      geochart.draw(data, {width: 530, height: 300});     
    }
   
    
    function print_r(arr,level) {
var dumped_text = "";
if(!level) level = 0;

//The padding given at the beginning of the line.
var level_padding = "";
for(var j=0;j<level+1;j++) level_padding += "    ";

if(typeof(arr) == 'object') { //Array/Hashes/Objects 
    for(var item in arr) {
        var value = arr[item];

        if(typeof(value) == 'object') { //If it is an array,
            dumped_text += level_padding + "'" + item + "' ...\n";
            dumped_text += print_r(value,level+1);
        } else {
            dumped_text += level_padding + "'" + item + "' => \"" + value + "\"\n";
        }
    }
} else { //Stings/Chars/Numbers etc.
    dumped_text = "===>"+arr+"<===("+typeof(arr)+")";
}
return dumped_text;
}
  </script>
  
<table><tr><td bgcolor=#dddddd nowrap><font size=+1>Top 10</font>&nbsp;&nbsp;</td>
<td nowrap>&nbsp;&nbsp;<font size=+1><a href="{% url metashare.views.frontpage %}stats/usage/">Usage statistics</a></font>&nbsp;&nbsp; </td>
{% if user.username and myres %}
<td nowrap>&nbsp;&nbsp;<font size=+1><a href="{% url metashare.views.frontpage %}stats/mystats/">My resources</a></font>&nbsp;&nbsp; </td>
{% endif %}
<td></td></tr>
<tr><td bgcolor=#dddddd colspan=4>

<div class="content_box">

<form class="form_helper" name="topform" id="topform" action="{% url metashare.views.frontpage %}stats/top/" method="get">
<table>
<tr><td>
<select name='view' onchange="topform.submit();">

<option value='topviewed' style="background-image: url({{ MEDIA_URL }}stats/img/view_icon.gif); background-repeat: no-repeat;"
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Most Viewed Resources

<option value='topdownloaded' style="background-image: url({{ MEDIA_URL }}stats/img/download_icon.gif); background-repeat: no-repeat;"
{% ifequal view "topdownloaded" %}
        selected
{% endifequal %}
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Top Downloaded Resources

<option value='topqueries' style="background-image: url({{ MEDIA_URL }}stats/img/retrieve_icon.gif); background-repeat: no-repeat;"
{% ifequal view "topqueries" %}
        selected
{% endifequal %}

> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Top Queries

<option value='latestupdated' style="background-image: url({{ MEDIA_URL }}stats/img/update_icon.gif); background-repeat: no-repeat;"
{% ifequal view "latestupdated" %}
        selected
{% endifequal %}

> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Latest Updated Resources

<option value='latestqueries' style="background-image: url({{ MEDIA_URL }}stats/img/retrieve_icon.gif); background-repeat: no-repeat;"
{% ifequal view "latestqueries" %} 
	selected
{% endifequal %}
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Latest Queries
</select>

{% if countrycode != None and countrycode|length > 0 %}
    from {{ countryname }} <img height=20 src="{{ MEDIA_URL }}css/international_flags/iso/32x32/flag-{{ countrycode|lower }}.png">
{% endif %} 
</td></tr></table>
</form>

{% if topdata|length <= 0 %}
    <center><strong>No data found</strong></center>
{% else %}
<table class="result_table">
<tr class="result_table_head">
{% ifequal view "latestqueries" %}
  <td width="60%" nowrap>Query, Filters</td>
  <td width="15%" nowrap>Found results</td>
  <td width="25%">Time</td>
{% else %}
    {% ifequal view "topqueries" %}
        <td width="80%" nowrap>Query, Filters</td>
        <td width="15%" nowrap>Count</td>
    {% else %}
      <td width="5%">Id</td>
      <td width="70%">Title</td>
      {% ifequal view "latestupdated" %}
        <td width="25%">Date</td>
      {% else %}
        <td width="25%">Count</td>
      {% endifequal %}
    {% endifequal %}
{% endifequal %}
</tr>

{% for stat in topdata %}
    <tr class="{% cycle odd,even %} content">
    {% if "quer" in view %}  
        <td nowrap><a href="{% url metashare.views.frontpage %}repository/search/?{{ stat.4 }}"><img src="{{ MEDIA_URL }}css/sexybuttons/images/icons/silk/zoom.png"> {{ stat.0 }}</a>
        {% ifnotequal stat.1 "" %}  
            {{ stat.1 }}
        {% endifnotequal %}
        </td>
        <td width=100%>{{ stat.3 }}</td>
        <td nowrap>{{ stat.2 }}</td>
    {% else %} 
       <th style="text-align:right;" nowrap>{{ stat.0 }}</th>
       <td width=100%><a href="{{ stat.1 }}">{{ stat.3 }}</a></td>
       <td nowrap>
       {% ifequal view "latestupdated" %}   
            {{ stat.2 }}
       {% else %}
            <b>{{ stat.2 }}</b>
       {% endifequal %}
       </td>
    {% endif %}
    </tr>
{% endfor %}
</table>
</div>


{% if geovisits|length > 0 %}
<div class="filter_box" style="margin-top: 10px; margin-left: 10px">
  <table class="result_table">
     <td valign=top>
        <table valign=top>
            <tr class="result_table_head"><td nowrap>{{ visitstitle }}</td></tr>
        {% for geoinfo in geovisits %}
            <tr>
                <td nowrap> 
                    {% if geoinfo.0|length > 0 %}
                        <a href="{% url metashare.views.frontpage %}stats/top/?view={{ view }}&country={{ geoinfo.0 }}">{{ geoinfo.2 }}</a> </td>
                        <td>
                        <img height=20 src="{{ MEDIA_URL }}css/international_flags/iso/32x32/flag-{{ geoinfo.0|lower }}.png">
                    {% else %}
                        {{ geoinfo.2 }}</td>
                        <td>
                    {% endif %}
                </td>
                <td>{{ geoinfo.1 }}</td>
            </tr>
        {% endfor %}
        </table>
     </td>
     <td><div id="googlemap" style="width: 100%; height: 300px;"></div>
         <div style="font-size:7pt;text-align:left">* This product includes GeoLite data created by MaxMind, available from http://maxmind.com/ and a Google Maps chart.</div>
     </td>
     </table>
</div>
{% endif %}

{% endif %}


</td></tr></table>
  
{% endblock %}

  
  

